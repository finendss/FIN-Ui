local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TextChatService = game:GetService("TextChatService")
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")

-- åˆå§‹åŒ–ç¯å¢ƒå˜é‡
_env = {
    SpeedBoost = false,
    SpeedBoostValue = 1,
    NoStun = false,
    Fullbright = false,
    Brightness = 0,
    GlobalShadows = false,
    NoFog = false
}

-- ä½“åŠ›ç³»ç»Ÿè®¾ç½®
local StaminaSettings = {
    MaxStamina = 100,      -- æœ€å¤§ä½“åŠ›å€¼
    StaminaGain = 25,      -- ä½“åŠ›æ¢å¤é€Ÿåº¦
    StaminaLoss = 10,      -- ä½“åŠ›æ¶ˆè€—é€Ÿåº¦
    SprintSpeed = 28,      -- å¥”è·‘é€Ÿåº¦
    InfiniteGain = 9999    -- æ— é™ä½“åŠ›æ¢å¤é€Ÿåº¦
}

WindUI:Popup({
    Title = "æ¬¢è¿ä½¿ç”¨XP KFI Script",
    Icon = "sparkles",
    Content = "å°Šæ•¬çš„XP KFIç”¨æˆ·ğŸ‘‘,ç¥ä½ å¤©å¤©å¼€å¿ƒ",
    Buttons = {
        {
            Title = "å¯åŠ¨XP KFI",
            Icon = "arrow-right",
            Variant = "Primary",
            Callback = function()
                print("å¯åŠ¨XP")
                -- åˆ›å»ºä¸»çª—å£
                createMainWindow()
            end
        }
    }
})

local UserGui = Instance.new("ScreenGui", game.CoreGui)
local UICorner = Instance.new("UICorner")
local BackgroundRect = Instance.new("Frame", UserGui)
local RectGradient = Instance.new("UIGradient")
local UserLabel = Instance.new("TextLabel", UserGui)
local TextGradient = Instance.new("UIGradient")

UserGui.Name = "UserGui"
UserGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
UserGui.Enabled = true

BackgroundRect.Name = "BackgroundRect"
BackgroundRect.BackgroundColor3 = Color3.new(0, 0, 0)
BackgroundRect.BackgroundTransparency = 1
BackgroundRect.BorderSizePixel = 0
BackgroundRect.Position = UDim2.new(0.7, 0, 0.02, 0)
BackgroundRect.Size = UDim2.new(0, 220, 0, 70)
BackgroundRect.ZIndex = 1

UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = BackgroundRect

RectGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0.00, Color3.fromRGB(255, 0, 0)),
    ColorSequenceKeypoint.new(0.10, Color3.fromRGB(255, 127, 0)),
    ColorSequenceKeypoint.new(0.20, Color3.fromRGB(255, 255, 0)),
    ColorSequenceKeypoint.new(0.30, Color3.fromRGB(0, 255, 0)),
    ColorSequenceKeypoint.new(0.40, Color3.fromRGB(0, 255, 255)),
    ColorSequenceKeypoint.new(0.50, Color3.fromRGB(0, 0, 255)),
    ColorSequenceKeypoint.new(0.60, Color3.fromRGB(139, 0, 255)),
    ColorSequenceKeypoint.new(0.70, Color3.fromRGB(255, 0, 0)),
    ColorSequenceKeypoint.new(0.80, Color3.fromRGB(255, 127, 0)),
    ColorSequenceKeypoint.new(0.90, Color3.fromRGB(255, 255, 0)),
    ColorSequenceKeypoint.new(1.00, Color3.fromRGB(0, 255, 0))
}
RectGradient.Rotation = 10
RectGradient.Parent = BackgroundRect

UserLabel.Name = "UserLabel"
UserLabel.BackgroundTransparency = 1 -- èƒŒæ™¯é€æ˜åº¦
UserLabel.Position = UDim2.new(0.7, 0, 0.02, 0)
UserLabel.Size = UDim2.new(0, 220, 0, 70)
UserLabel.Font = Enum.Font.GothamSemibold
UserLabel.Text = "XpSaken é™å…ç‰ˆç”¨æˆ·ï¼š" .. game.Players.LocalPlayer.Name
UserLabel.TextColor3 = Color3.new(1, 1, 1)
UserLabel.TextTransparency = 0
UserLabel.TextScaled = false
UserLabel.TextSize = 16 --å­—ä½“å¤§å°
UserLabel.TextWrapped = true
UserLabel.Visible = true
UserLabel.ZIndex = 2

TextGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0.00, Color3.fromRGB(255, 0, 0)),
    ColorSequenceKeypoint.new(0.10, Color3.fromRGB(255, 127, 0)),
    ColorSequenceKeypoint.new(0.20, Color3.fromRGB(255, 255, 0)),
    ColorSequenceKeypoint.new(0.30, Color3.fromRGB(0, 255, 0)),
    ColorSequenceKeypoint.new(0.40, Color3.fromRGB(0, 255, 255)),
    ColorSequenceKeypoint.new(0.50, Color3.fromRGB(0, 0, 255)),
    ColorSequenceKeypoint.new(0.60, Color3.fromRGB(139, 0, 255)),
    ColorSequenceKeypoint.new(0.70, Color3.fromRGB(255, 0, 0)),
    ColorSequenceKeypoint.new(0.80, Color3.fromRGB(255, 127, 0)),
    ColorSequenceKeypoint.new(0.90, Color3.fromRGB(255, 255, 0)),
    ColorSequenceKeypoint.new(1.00, Color3.fromRGB(0, 255, 0))
}
TextGradient.Rotation = 10
TextGradient.Parent = UserLabel

local TweenService = game:GetService("TweenService")
local tweenInfo = TweenInfo.new(7, Enum.EasingStyle.Linear, Enum.EasingDirection.In, -1)
TweenService:Create(RectGradient, tweenInfo, {Rotation = 360}):Play()
TweenService:Create(TextGradient, tweenInfo, {Rotation = 360}):Play()

-- è¾…åŠ©å‡½æ•°ï¼šé€’å½’æŸ¥æ‰¾å­å¯¹è±¡
local function findFirstChildRecursive(parent, name)
    if parent.Name == name then
        return parent
    end

    for _, child in ipairs(parent:GetChildren()) do
        local result = findFirstChildRecursive(child, name)
        if result then
            return result
        end
    end

    return nil
end

-- è·å–æ¸¸æˆä½“åŠ›æ¨¡å—
local function GetSprintingModule()
    -- å°è¯•å¤šç§å¯èƒ½çš„è·¯å¾„
    local possiblePaths = {
        ReplicatedStorage:FindFirstChild("Systems") and ReplicatedStorage.Systems:FindFirstChild("Character") and ReplicatedStorage.Systems.Character:FindFirstChild("Game") and ReplicatedStorage.Systems.Character.Game:FindFirstChild("Sprinting"),
        ReplicatedStorage:FindFirstChild("Modules") and ReplicatedStorage.Modules:FindFirstChild("Character") and ReplicatedStorage.Modules.Character:FindFirstChild("Sprinting"),
        ReplicatedStorage:FindFirstChild("Sprinting")
    }

    for _, module in ipairs(possiblePaths) do
        if module then
            return require(module)
        end
    end

    warn("æ— æ³•æ‰¾åˆ°ä½“åŠ›æ¨¡å—!")
    return nil
end

function createMainWindow()
    local LocalPlayer = Players.LocalPlayer
    local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hum = Character:WaitForChild("HumanoidRootPart")
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

    -- å£°æ˜æ‰€æœ‰çº¿ç¨‹æ§åˆ¶å˜é‡
    local teleportMedkitThread, teleportColaThread, medkitThread, colaThread
    local autoTeleportMedkitEnabled, autoTeleportColaEnabled, autoMedkitEnabled, autoColaEnabled
    
    local Window = WindUI:CreateWindow({
        Title = "XpSaken / XP KFI Hub",
        Icon = "rbxassetid://4483362748",
        IconTransparency = 0.5,
        IconThemed = true,
        Author = "XP Team",
        Folder = "CloudHub",
        Size = UDim2.fromOffset(400, 300),
        Transparent = true,
        Theme = "Light",
        User = {
            Enabled = true,
            Callback = function() print("clicked") end,
            Anonymous = false
        },
        SideBarWidth = 200,
        ScrollBarEnabled = true,
        Background = "rbxassetid://73416826039813"
    })
    Window:Tag({
        Title = "XPç”¨æˆ·",
        Color = Color3.fromHex("#30ff6a")
    })
    Window:Tag({
        Title = "é™å…ç‰ˆ",
        Color = Color3.fromHex("#315dff")
    })
    local TimeTag = Window:Tag({
        Title = "æŒç»­æ›´æ–°",
        Color = Color3.fromHex("#000000")
    })
    Window:EditOpenButton({
        Title = "XpSaken",
        Icon = "star",
        CornerRadius = UDim.new(0,16),
        StrokeThickness = 2,
        Color = ColorSequence.new(
            Color3.fromHex("FF0F7B"),
            Color3.fromHex("F89B29")
        ),
        Draggable = true,
    })

    -- æ·»åŠ å½©è™¹è¾¹æ¡†æ•ˆæœ
    Window:EditOpenButton({
        StrokeColor = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),     -- çº¢è‰²
            ColorSequenceKeypoint.new(0.2, Color3.fromRGB(255, 165, 0)), -- æ©™è‰²
            ColorSequenceKeypoint.new(0.4, Color3.fromRGB(255, 255, 0)), -- é»„è‰²
            ColorSequenceKeypoint.new(0.6, Color3.fromRGB(0, 255, 0)),   -- ç»¿è‰²
            ColorSequenceKeypoint.new(0.8, Color3.fromRGB(0, 0, 255)),   -- è“è‰²
            ColorSequenceKeypoint.new(1, Color3.fromRGB(128, 0, 128))    -- ç´«è‰²
        }),
        StrokeThickness = 3,  -- å¢åŠ è¾¹æ¡†åšåº¦
    })

    local MainTab = Window:Tab({
        Title = "ä¸»é¡µ",
        Icon = "zap",
        Locked = false,
    })

    MainTab:Paragraph({
        Title = "æ¬¢è¿ä½¿ç”¨ XPSaken",
        Desc = "åŠ å…¥QQç¾¤è·å–æœ€æ–°æ¶ˆæ¯ 951740588",
        Image = "rbxassetid://114477834305321",
        ImageSize = 42,
        Thumbnail = "rbxassetid://96291371536118",
        ThumbnailSize = 120
    })

    MainTab:Paragraph({
        Title = "æ›´æ–°æ—¥å¿—",
        Desc = "[+]å°†åŸºç¡€åŠŸèƒ½æ›´æ–°,ä¿®æ”¹ç§»é€Ÿçš„åŠŸèƒ½ ä¿®æ”¹ç»˜åˆ¶çš„åŠŸèƒ½[æ— bug]",
    })
    
    local Tab = Window:Tab({
        Title = "åŸºç¡€åŠŸèƒ½",
        Icon = "drama",
        Locked = false,
    })
    
    -- é˜²çœ©æ™•åŠŸèƒ½
    local function setupNoStun()
        LocalPlayer.Character.Humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
            if _env.NoStun and LocalPlayer.Character.Humanoid.WalkSpeed < 16 then
                LocalPlayer.Character.Humanoid.WalkSpeed = 16
            end
        end)
        LocalPlayer.CharacterAdded:Connect(function()
            LocalPlayer.Character.Humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
                if _env.NoStun and LocalPlayer.Character.Humanoid.WalkSpeed < 16 then
                    LocalPlayer.Character.Humanoid.WalkSpeed = 16
                end
            end)
        end)
    end
    
    -- é€Ÿåº¦æå‡åŠŸèƒ½
    local function setupSpeedBoost()
        if _env.SpeedBoost then
            while _env.SpeedBoost and task.wait() do
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame +
                    LocalPlayer.Character.Humanoid.MoveDirection * _env.SpeedBoostValue
                    LocalPlayer.Character.HumanoidRootPart.CanCollide = true
                end
            end
        end
    end
    
    local Slider = Tab:Slider({
        Title = "ç§»é€Ÿè°ƒèŠ‚",
        Value = {
            Min = 0,
            Max = 3,
            Default = 1,
        },
        Increment = 1,
        Callback = function(v)
            _env.SpeedBoostValue = v
        end
    })
    
    local Toggle = Tab:Toggle({
        Title = "å¯åŠ¨é€Ÿåº¦",
        Desc = "å–µå–µå–µ",
        Locked = false,
        Callback = function(v)
            _env.SpeedBoost = v
            if v then
                task.spawn(setupSpeedBoost)
            end
        end
    })

    local Toggle2 = Tab:Toggle({
        Title = "å»é™¤å‰æ‘‡ä¸åæ‘‡",
        Desc = "FIN",
        Locked = false,
        Callback = function(v)
            _env.NoStun = v
            if v then
                setupNoStun()
            end
        end
    })

    local Toggle3 = Tab:Toggle({
        Title = "æ˜¾ç¤ºå±€å†…èŠå¤©æ¡†",
        Desc = "FIN",
        Locked = false,
        Callback = function(state)
            if TextChatService:FindFirstChild("ChatWindowConfiguration") then
                TextChatService.ChatWindowConfiguration.Enabled = state
            end
        end
    })
    
    -- é«˜äº®å’Œå…‰ç…§è®¾ç½®
    local function setupLighting()
        if not Lighting:GetAttribute("FogStart") then
            Lighting:SetAttribute("FogStart", Lighting.FogStart)
        end
        if not Lighting:GetAttribute("FogEnd") then
            Lighting:SetAttribute("FogEnd", Lighting.FogEnd)
        end

        Lighting.FogStart = _env.NoFog and 0 or Lighting:GetAttribute("FogStart")
        Lighting.FogEnd = _env.NoFog and math.huge or Lighting:GetAttribute("FogEnd")

        local fog = Lighting:FindFirstChildOfClass("Atmosphere")
        if fog then
            if not fog:GetAttribute("Density") then
                fog:SetAttribute("Density", fog.Density)
            end
            fog.Density = _env.NoFog and 0 or fog:GetAttribute("Density")
        end

        if _env.Fullbright then
            Lighting.OutdoorAmbient = Color3.new(1,1,1)
            Lighting.Brightness = _env.Brightness or 0
            Lighting.GlobalShadows = not _env.GlobalShadows
        else
            Lighting.OutdoorAmbient = Color3.fromRGB(55,55,55)
            Lighting.Brightness = 0
            Lighting.GlobalShadows = true
        end
    end
    
    local Toggle4 = Tab:Toggle({
        Title = "å¯ç”¨é«˜äº®",
        Desc = "FIN",
        Locked = false,
        Callback = function(v)
            _env.Fullbright = v
            if v then
                RunService.RenderStepped:Connect(setupLighting)
            else
                setupLighting()
            end
        end
    })
    
    local Slider2 = Tab:Slider({
        Title = "äº®åº¦è°ƒèŠ‚",
        Value = {
            Min = 0,
            Max = 5,
            Default = 0,
        },
        Increment = 1,
        Callback = function(v)
            _env.Brightness = v
            setupLighting()
        end
    })
    
    local Toggle5 = Tab:Toggle({
        Title = "å»é™¤é˜´å½±",
        Desc = "FIN",
        Locked = false,
        Callback = function(v)
            _env.GlobalShadows = v
            setupLighting()
        end
    })
    
    local Toggle6 = Tab:Toggle({
        Title = "å»é™¤è¿·é›¾",
        Desc = "FIN",
        Locked = false,
        Callback = function(v)
            _env.NoFog = v
            setupLighting()
        end
    })
    
    -- ä½“åŠ›åŠŸèƒ½æ ‡ç­¾é¡µ
    local Tab2 = Window:Tab({
        Title = "ä½“åŠ›åŠŸèƒ½",
        Icon = "activity",
        Locked = false,
    })

    -- å®æ—¶æ›´æ–°ä½“åŠ›è®¾ç½®
    task.spawn(function()
        while true do
            local m = GetSprintingModule()
            if m then
                for key, value in pairs(StaminaSettings) do
                    m[key] = value
                end
            end
            task.wait(0.5)
        end
    end)

    -- æ— é™ä½“åŠ›åŠŸèƒ½
    local bai = {Spr = false}
    local connection

    local Toggle7 = Tab2:Toggle({
        Title = "æ— é™ä½“åŠ›",
        Desc = "å¼€å¯åä½“åŠ›ä¸ä¼šæ¶ˆè€—",
        Locked = false,
        Callback = function(state)
            bai.Spr = state
            local Sprinting = GetSprintingModule()

            if not Sprinting then
                warn("æ— æ³•æ‰¾åˆ°ä½“åŠ›æ¨¡å—!")
                return
            end

            if state then
                Sprinting.StaminaLoss = 0
                Sprinting.StaminaGain = StaminaSettings.InfiniteGain or 9999

                if connection then connection:Disconnect() end
                connection = RunService.Heartbeat:Connect(function()
                    if not bai.Spr then return end
                    Sprinting.StaminaLoss = 0
                    Sprinting.StaminaGain = StaminaSettings.InfiniteGain or 9999
                end)
            else
                Sprinting.StaminaLoss = StaminaSettings.StaminaLoss or 10
                Sprinting.StaminaGain = StaminaSettings.StaminaGain or 25

                if connection then
                    connection:Disconnect()
                    connection = nil
                end
            end
        end
    })

    -- ä½“åŠ›å‚æ•°è°ƒèŠ‚
    Tab2:Slider({
        Title = "æ— é™ä½“åŠ›æ¢å¤é€Ÿåº¦",
        Value = {
            Min = 0,
            Max = 50000,
            Default = 9999,
        },
        Increment = 1,
        Callback = function(Value)
            StaminaSettings.InfiniteGain = Value
        end
    })

    Tab2:Slider({
        Title = "ä½“åŠ›å¤§å°",
        Value = {
            Min = 0,
            Max = 99999,
            Default = 100,
        },
        Increment = 1,
        Callback = function(Value)
            StaminaSettings.MaxStamina = Value
        end
    })

    Tab2:Slider({
        Title = "ä½“åŠ›æ¢å¤",
        Value = {
            Min = 0,
            Max = 250,
            Default = 25,
        },
        Increment = 1,
        Callback = function(Value)
            StaminaSettings.StaminaGain = Value
        end
    })

    Tab2:Slider({
        Title = "ä½“åŠ›æ¶ˆè€—",
        Value = {
            Min = 0,
            Max = 100,
            Default = 10,
        },
        Increment = 1,
        Callback = function(Value)
            StaminaSettings.StaminaLoss = Value
        end
    })

    Tab2:Slider({
        Title = "å¥”è·‘é€Ÿåº¦",
        Value = {
            Min = 0,
            Max = 200,
            Default = 28,
        },
        Increment = 1,
        Callback = function(Value)
            StaminaSettings.SprintSpeed = Value
        end
    })

    -- å…¶ä»–æ ‡ç­¾é¡µä¿æŒä¸å˜...
    local Tab3 = Window:Tab({
        Title = "è‡ªåŠ¨æ”¶å–ç‰©å“",
        Icon = "package",
        Locked = false,
    })
    
    -- åŒ»ç–—åŒ…ä¼ é€åŠŸèƒ½
    local function teleportMedkit()
        while autoTeleportMedkitEnabled and task.wait(0.5) do
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                local humanoidRootPart = character.HumanoidRootPart

                local medkit = workspace:FindFirstChild("Map", true)
                if medkit then
                    medkit = medkit:FindFirstChild("Ingame", true)
                    if medkit then
                        medkit = medkit:FindFirstChild("Medkit", true)
                        if medkit then
                            local itemRoot = medkit:FindFirstChild("ItemRoot", true)
                            if itemRoot then
                                itemRoot.CFrame = humanoidRootPart.CFrame + humanoidRootPart.CFrame.LookVector * 3

                                local prompt = itemRoot:FindFirstChild("ProximityPrompt", true)
                                if prompt then
                                    fireproximityprompt(prompt)
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    
    local Toggle8 = Tab3:Toggle({
        Title = "åŒ»ç–—åŒ…ä¼ é€ä¸”è·å–",
        Desc = "FIN",
        Locked = false,
        Callback = function(state)
            autoTeleportMedkitEnabled = state

            if autoTeleportMedkitEnabled then
                teleportMedkitThread = task.spawn(teleportMedkit)
            elseif teleportMedkitThread then
                task.cancel(teleportMedkitThread)
                teleportMedkitThread = nil
            end
        end
    })
    
    -- å¯ä¹ç½ä¼ é€åŠŸèƒ½
    local function teleportCola()
        while autoTeleportColaEnabled and task.wait(0.5) do
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                local humanoidRootPart = character.HumanoidRootPart

                local cola = workspace:FindFirstChild("Map", true)
                if cola then
                    cola = cola:FindFirstChild("Ingame", true)
                    if cola then
                        cola = cola:FindFirstChild("BloxyCola", true)
                        if cola then
                            local itemRoot = cola:FindFirstChild("ItemRoot", true)
                            if itemRoot then
                                itemRoot.CFrame = humanoidRootPart.CFrame + humanoidRootPart.CFrame.LookVector * 3

                                local prompt = itemRoot:FindFirstChild("ProximityPrompt", true)
                                if prompt then
                                    fireproximityprompt(prompt)
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    
    local Toggle9 = Tab3:Toggle({
        Title = "å¯ä¹ç½ä¼ é€ä¸”è·å–",
        Desc = "FIN",
        Locked = false,
        Callback = function(state)
            autoTeleportColaEnabled = state

            if autoTeleportColaEnabled then
                teleportColaThread = task.spawn(teleportCola)
            elseif teleportColaThread then
                task.cancel(teleportColaThread)
                teleportColaThread = nil
            end
        end
    })
    
    -- è‡ªåŠ¨äº’åŠ¨åŒ»ç–—åŒ…åŠŸèƒ½
    local function autoMedkit()
        while autoMedkitEnabled and task.wait(0.5) do
            local medkit = workspace:FindFirstChild("Map", true)
            if medkit then
                medkit = medkit:FindFirstChild("Ingame", true)
                if medkit then
                    medkit = medkit:FindFirstChild("Medkit", true)
                    if medkit then
                        local itemRoot = medkit:FindFirstChild("ItemRoot", true)
                        if itemRoot then
                            local prompt = itemRoot:FindFirstChild("ProximityPrompt", true)
                            if prompt then
                                fireproximityprompt(prompt)
                            end
                        end
                    end
                end
            end
        end
    end
    
    local Toggle10 = Tab3:Toggle({
        Title = "è‡ªåŠ¨äº’åŠ¨åŒ»ç–—åŒ…",
        Desc = "ä¸å…³ä¸Šæ— æ³•ä¸¢å¼ƒğŸ’€",
        Locked = false,
        Callback = function(state)
            autoMedkitEnabled = state

            if autoMedkitEnabled then
                medkitThread = task.spawn(autoMedkit)
            elseif medkitThread then
                task.cancel(medkitThread)
                medkitThread = nil
            end
        end
    })
    
    -- è‡ªåŠ¨äº’åŠ¨å¯ä¹ç½åŠŸèƒ½
    local function autoCola()
        while autoColaEnabled and task.wait(0.5) do
            local cola = workspace:FindFirstChild("Map", true)
            if cola then
                cola = cola:FindFirstChild("Ingame", true)
                if cola then
                    cola = cola:FindFirstChild("BloxyCola", true)
                    if cola then
                        local itemRoot = cola:FindFirstChild("ItemRoot", true)
                        if itemRoot then
                            local prompt = itemRoot:FindFirstChild("ProximityPrompt", true)
                            if prompt then
                                fireproximityprompt(prompt)
                            end
                        end
                    end
                end
            end
        end
    end
    
    local Toggle11 = Tab3:Toggle({
        Title = "è‡ªåŠ¨äº’åŠ¨å¯ä¹ç½",
        Desc = "ä¸å…³ä¸Šæ— æ³•ä¸¢å¼ƒğŸ’€",
        Locked = false,
        Callback = function(state)
            autoColaEnabled = state

            if autoColaEnabled then
                colaThread = task.spawn(autoCola)
            elseif colaThread then
                task.cancel(colaThread)
                colaThread = nil
            end
        end
    })
    
    local Tab4 = Window:Tab({
        Title = "ä¿®å‘åŠ¨æœº",
        Icon = "settings",
        Locked = false,
    })
    
    local Toggle12 = Tab4:Toggle({
        Title = "è‡ªåŠ¨ä¿®æœº",
        Desc = "FIN",
        Locked = false,
        Callback = function(state)
            _G.BTE = state
            _G.REP = _G.REP or 1.80
            local function RepairGenerators()
                local map = workspace:FindFirstChild("Map")
                local ingame = map and map:FindFirstChild("Ingame")
                local currentMap = ingame and ingame:FindFirstChild("Map")
                if currentMap then
                    for _, obj in ipairs(currentMap:GetChildren()) do
                        if obj.Name == "Generator" and obj:FindFirstChild("Progress") and obj.Progress.Value < 100 then
                            local remote = obj:FindFirstChild("Remotes") and obj.Remotes:FindFirstChild("RE")
                            if remote then
                                remote:FireServer()
                            end
                        end
                    end
                end
            end
            if state then
                task.spawn(function()
                    while _G.BTE do
                        RepairGenerators()
                        task.wait(_G.REP)
                    end
                end)
            end
        end
    })
    
    local Tab5 = Window:Tab({
        Title = "ç»˜åˆ¶",
        Icon = "eye",
        Locked = false,
    })
    
    local Button = Tab5:Button({
        Title = "ä¸€é”®ç»˜åˆ¶",
        Desc = "ç»˜åˆ¶å¹¸å­˜è€… æ€æ‰‹ å‘ç”µæœº",
        Locked = false,
        Callback = function()
            local sur = workspace.Players.Survivors
            local kil = workspace.Players.Killers
            local spe = workspace.Players.Spectating
            local ing = workspace.Map.Ingame
            print("By Syndrome")
            local function survivoresp(char)
                local billboard = Instance.new("BillboardGui")
                billboard.Size = UDim2.new(2, 0, 0.5, 0)
                billboard.StudsOffset = Vector3.new(0, 1.25, 0)
                billboard.Adornee = char.Head
                billboard.Parent = char.Head
                billboard.AlwaysOnTop = true
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.Position = UDim2.new(0, 1, 0, 1)
                textLabel.BackgroundTransparency = 1
                textLabel.TextScaled = true
                textLabel.Text = "è¡€é‡: "..char.Humanoid.Health.."/"..char.Humanoid.MaxHealth
                textLabel.TextColor3 = Color3.fromRGB(255, 100, 28)
                textLabel.Font = Enum.Font.Arcade
                textLabel.Parent = billboard
                local charnamebill = Instance.new("BillboardGui")
                charnamebill.Size = UDim2.new(9, 0, 1, 0)
                charnamebill.StudsOffset = Vector3.new(0, 2, 0)
                charnamebill.Adornee = char.Head
                charnamebill.Parent = char.Head
                charnamebill.AlwaysOnTop = true
                local charnametext = Instance.new("TextLabel")
                charnametext.Size = UDim2.new(1, 0, 1, 0)
                charnametext.Position = UDim2.new(0, 1, 0, 1)
                charnametext.BackgroundTransparency = 1
                charnametext.TextScaled = true
                charnametext.Text = char.Name
                charnametext.TextColor3 = Color3.fromRGB(255, 100, 28)
                charnametext.Font = Enum.Font.Arcade
                charnametext.Parent = charnamebill
                local highlight = Instance.new("Highlight")
                highlight.Archivable = true
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlight.Enabled = true
                highlight.OutlineColor = Color3.fromRGB(255, 100, 28)
                highlight.FillColor = Color3.fromRGB(255, 100, 28)
                highlight.FillTransparency = 0.9
                highlight.OutlineTransparency = 0
                highlight.Parent = char
                local temp = char:FindFirstChild("Humanoid").HealthChanged:Connect(function()
                    textLabel.Text = "è¡€é‡: "..char:FindFirstChild("Humanoid").Health.."/"..char:FindFirstChild("Humanoid").MaxHealth
                end)
                char:FindFirstChild("Humanoid").Died:Connect(function()
                    temp:Disconnect()
                    textLabel.Text = ""
                    charnametext.Text = ""
                    highlight.OutlineTransparency = 1
                end)
                return textLabel
            end
            local function killeresp(char)
                local billboard = Instance.new("BillboardGui")
                billboard.Size = UDim2.new(2, 0, 0.5, 0)
                billboard.StudsOffset = Vector3.new(0, 1.25, 0)
                billboard.Adornee = char.Head
                billboard.Parent = char.Head
                billboard.AlwaysOnTop = true
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.Position = UDim2.new(0, 1, 0, 1)
                textLabel.BackgroundTransparency = 1
                textLabel.TextScaled = true
                textLabel.Text = "è¡€é‡: "..char.Humanoid.Health.."/"..char.Humanoid.MaxHealth
                textLabel.TextColor3 = Color3.fromRGB(204, 0, 0)
                textLabel.Font = Enum.Font.Arcade
                textLabel.Parent = billboard
                local charnamebill = Instance.new("BillboardGui")
                charnamebill.Size = UDim2.new(9, 0, 1, 0)
                charnamebill.StudsOffset = Vector3.new(0, 2, 0)
                charnamebill.Adornee = char.Head
                charnamebill.Parent = char.Head
                charnamebill.AlwaysOnTop = true
                local charnametext = Instance.new("TextLabel")
                charnametext.Size = UDim2.new(1, 0, 1, 0)
                charnametext.Position = UDim2.new(0, 1, 0, 1)
                charnametext.BackgroundTransparency = 1
                charnametext.TextScaled = true
                charnametext.Text = char.Name
                charnametext.TextColor3 = Color3.fromRGB(204, 0, 0)
                charnametext.Font = Enum.Font.Arcade
                charnametext.Parent = charnamebill
                local highlight = Instance.new("Highlight")
                highlight.Archivable = true
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlight.Enabled = true
                highlight.OutlineColor = Color3.fromRGB(204, 0, 0)
                highlight.FillColor = Color3.fromRGB(204, 0, 0)
                highlight.FillTransparency = 0.9
                highlight.OutlineTransparency = 0
                highlight.Parent = char
                local temp = char:FindFirstChild("Humanoid").HealthChanged:Connect(function()
                    textLabel.Text = "è¡€é‡: "..char:FindFirstChild("Humanoid").Health.."/"..char:FindFirstChild("Humanoid").MaxHealth
                end)
                char:FindFirstChild("Humanoid").Died:Connect(function()
                    temp:Disconnect()
                    textLabel.Text = ""
                    charnametext.Text = ""
                    highlight.OutlineTransparency = 1
                end)
                return textLabel
            end
            local function specesp(char)
                local billboard = Instance.new("BillboardGui")
                billboard.Size = UDim2.new(2, 0, 0.5, 0)
                billboard.StudsOffset = Vector3.new(0, 1.25, 0)
                billboard.Adornee = char.Head
                billboard.Parent = char.Head
                billboard.AlwaysOnTop = true
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.Position = UDim2.new(0, 1, 0, 1)
                textLabel.BackgroundTransparency = 1
                textLabel.TextScaled = true
                textLabel.Text = "è¡€é‡: "..char.Humanoid.Health.."/"..char.Humanoid.MaxHealth
                textLabel.TextColor3 = Color3.fromRGB(117, 117, 117)
                textLabel.Font = Enum.Font.Arcade
                textLabel.Parent = billboard
                local charnamebill = Instance.new("BillboardGui")
                charnamebill.Size = UDim2.new(9, 0, 1, 0)
                charnamebill.StudsOffset = Vector3.new(0, 2, 0)
                charnamebill.Adornee = char.Head
                charnamebill.Parent = char.Head
                charnamebill.AlwaysOnTop = true
                local charnametext = Instance.new("TextLabel")
                charnametext.Size = UDim2.new(1, 0, 1, 0)
                charnametext.Position = UDim2.new(0, 1, 0, 1)
                charnametext.BackgroundTransparency = 1
                charnametext.TextScaled = true
                charnametext.Text = char.Name
                charnametext.TextColor3 = Color3.fromRGB(117, 117, 117)
                charnametext.Font = Enum.Font.Arcade
                charnametext.Parent = charnamebill
                local highlight = Instance.new("Highlight")
                highlight.Archivable = true
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlight.Enabled = true
                highlight.OutlineColor = Color3.fromRGB(117, 117, 117)
                highlight.FillColor = Color3.fromRGB(117, 117, 117)
                highlight.FillTransparency = 0.9
                highlight.OutlineTransparency = 0
                highlight.Parent = char
                local temp = char:FindFirstChild("Humanoid").HealthChanged:Connect(function()
                    textLabel.Text = "è¡€é‡: "..char:FindFirstChild("Humanoid").Health.."/"..char:FindFirstChild("Humanoid").MaxHealth
                end)
                char:FindFirstChild("Humanoid").Died:Connect(function()
                    temp:Disconnect()
                    textLabel.Text = ""
                    charnametext.Text = ""
                    highlight.OutlineTransparency = 1
                end)
                return textLabel
            end
            local function genesp(p)
                local billboard = Instance.new("BillboardGui")
                billboard.Size = UDim2.new(2, 0, 0.5, 0)
                billboard.StudsOffset = Vector3.new(0, 1.25, 0)
                billboard.Adornee = p.Main
                billboard.Parent = p.Main
                billboard.AlwaysOnTop = true
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.Position = UDim2.new(0, 1, 0, 1)
                textLabel.BackgroundTransparency = 1
                textLabel.TextScaled = true
                textLabel.Text = ""
                textLabel.TextColor3 = Color3.fromRGB(255, 206, 28)
                textLabel.Font = Enum.Font.Arcade
                textLabel.Parent = billboard
                local gennamebill = Instance.new("BillboardGui")
                gennamebill.Size = UDim2.new(9, 0, 1, 0)
                gennamebill.StudsOffset = Vector3.new(0, 2, 0)
                gennamebill.Adornee = p.Main
                gennamebill.Parent = p.Main
                gennamebill.AlwaysOnTop = true
                local gennametext = Instance.new("TextLabel")
                gennametext.Size = UDim2.new(1, 0, 1, 0)
                gennametext.Position = UDim2.new(0, 1, 0, 1)
                gennametext.BackgroundTransparency = 1
                gennametext.TextScaled = true
                gennametext.Text = p.Name
                gennametext.TextColor3 = Color3.fromRGB(255, 206, 28)
                gennametext.Font = Enum.Font.Arcade
                gennametext.Parent = gennamebill
                local highlight = Instance.new("Highlight")
                highlight.Archivable = true
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlight.Enabled = true
                highlight.OutlineColor = Color3.fromRGB(255, 206, 28)
                highlight.FillColor = Color3.fromRGB(255, 206, 28)
                highlight.FillTransparency = 0.9
                highlight.OutlineTransparency = 0
                highlight.Parent = p
                local temp = RunService.Heartbeat:Connect(function()
                    if p:FindFirstChild("Progress").Value >= 99 then
                        gennametext.Text = ""
                        highlight:Destroy()
                        textLabel.Text = ""
                    else
                        gennametext.Text = "Generator"
                        textLabel.Text = "ä¿®æœºè¿›åº¦: "..p.Progress.Value.."%"
                    end
                end)
                if p:FindFirstChild("Progress").Value >= 99 then
                    temp:Disconnect()
                end
                p.Destroying:Connect(function()
                    temp:Disconnect()
                end)
                return textLabel
            end
            local function itemesp(p)
                local billboard = Instance.new("BillboardGui")
                billboard.Size = UDim2.new(2, 0, 0.5, 0)
                billboard.StudsOffset = Vector3.new(0, 1.25, 0)
                billboard.Adornee = p:FindFirstChild("ItemRoot")
                billboard.Parent = p:FindFirstChild("ItemRoot")
                billboard.AlwaysOnTop = true
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.Position = UDim2.new(0, 1, 0, 1)
                textLabel.BackgroundTransparency = 1
                textLabel.TextScaled = true
                textLabel.Text = p.Name
                textLabel.TextColor3 = Color3.fromRGB(32, 54, 153)
                textLabel.Font = Enum.Font.Arcade
                textLabel.Parent = billboard
                local highlight = Instance.new("Highlight")
                highlight.Archivable = true
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlight.Enabled = true
                highlight.OutlineColor = Color3.fromRGB(32, 54, 153)
                highlight.FillColor = Color3.fromRGB(32, 54, 153)
                highlight.FillTransparency = 0.9
                highlight.OutlineTransparency = 0
                highlight.Parent = p
                return textLabel
            end
            sur.DescendantAdded:Connect(function(v)
                if v:IsA("Model") and v:FindFirstChild("Humanoid") then
                    repeat task.wait() until v:FindFirstChild("Humanoid")
                    survivoresp(v)
                end
            end)
            for _,v in pairs(sur:GetDescendants()) do
                if v:IsA("Model") and v:FindFirstChild("Humanoid") then
                    repeat task.wait() until v:FindFirstChild("Humanoid")
                    survivoresp(v)
                end
            end
            kil.DescendantAdded:Connect(function(v)
                if v:IsA("Model") and v:FindFirstChild("Humanoid")  then
                    repeat task.wait() until v:FindFirstChild("Humanoid")
                    killeresp(v)
                end
            end)
            for _,v in pairs(kil:GetDescendants()) do
                if v:IsA("Model") and v:FindFirstChild("Humanoid") then
                    repeat task.wait() until v:FindFirstChild("Humanoid")
                    killeresp(v)
                end
            end
            spe.DescendantAdded:Connect(function(v)
                if v:IsA("Model") and v:FindFirstChild("Humanoid") then
                    repeat task.wait() until v:FindFirstChild("Humanoid")
                    specesp(v)
                end
            end)
            for _,v in pairs(spe:GetDescendants()) do
                if v:IsA("Model") and v:FindFirstChild("Humanoid") then
                    repeat task.wait() until v:FindFirstChild("Humanoid")
                    specesp(v)
                end
            end
            ing.DescendantAdded:Connect(function(v)
                if v:IsA("Model") and v:FindFirstChild("Main")  and v.Name == "Generator" then
                    repeat task.wait() until v.Name == "Generator"
                    genesp(v)
                end
            end)
            for _,v in pairs(ing:GetDescendants()) do
                if v:IsA("Model") and v:FindFirstChild("Main") and v.Name == "Generator" then
                    repeat task.wait() until v.Name == "Generator"
                    genesp(v)
                end
            end
            ing.DescendantAdded:Connect(function(v)
                if v:IsA("Tool") then
                    repeat task.wait() until v:IsA("Tool")
                    itemesp(v)
                end
            end)
            for _,v in pairs(ing:GetDescendants()) do
                if v:IsA("Tool") then
                    repeat task.wait() until v:IsA("Tool")
                    itemesp(v)
                end
            end
        end
    })
    
    -- é«˜äº®ç»˜åˆ¶è®¾ç½®
    local HighlightSettings = {
        ShowSurvivorHighlights = true,
        ShowKillerHighlights = true,
        FillTransparency = 0.5,
        OutlineTransparency = 0,
        connection = nil,
        highlights = {}  -- å­˜å‚¨æ‰€æœ‰é«˜äº®å¯¹è±¡
    }
    
    -- æ›´æ–°é¢œè‰²é¢„è®¾
    HighlightSettings.SurvivorColors = {
        ["ç»¿è‰²"] = Color3.fromRGB(0, 255, 0),
        ["ç™½è‰²"] = Color3.fromRGB(255, 255, 255),
        ["ç´«è‰²"] = Color3.fromRGB(128, 0, 128),
        ["é’è‰²"] = Color3.fromRGB(0, 255, 255),
        ["æ©™è‰²"] = Color3.fromRGB(255, 165, 0),
        ["æŸ æª¬ç»¿"] = Color3.fromRGB(173, 255, 47)  -- æ–°å¢æŸ æª¬ç»¿
    }
    HighlightSettings.KillerColors = {
        ["çº¢è‰²"] = Color3.fromRGB(255, 0, 0),
        ["ç²‰è‰²"] = Color3.fromRGB(255, 105, 180),
        ["é»‘è‰²"] = Color3.fromRGB(0, 0, 0),
        ["è“è‰²"] = Color3.fromRGB(0, 0, 255),
        ["çŒ©çº¢è‰²"] = Color3.fromRGB(220, 20, 60),  -- æ–°å¢çŒ©çº¢è‰²
        ["æè‰²"] = Color3.fromRGB(251, 206, 177)   -- æ–°å¢æè‰²
    }
    
    -- è¾¹ç¼˜é¢œè‰²ä½¿ç”¨ä¸å¡«å……é¢œè‰²ç›¸åŒçš„é€‰é¡¹
    HighlightSettings.SurvivorOutlineColors = table.clone(HighlightSettings.SurvivorColors)
    HighlightSettings.KillerOutlineColors = table.clone(HighlightSettings.KillerColors)
    
    -- é»˜è®¤é¢œè‰²
    HighlightSettings.SelectedSurvivorColor = "é’è‰²"
    HighlightSettings.SelectedKillerColor = "çº¢è‰²"
    HighlightSettings.SelectedSurvivorOutlineColor = "é’è‰²"
    HighlightSettings.SelectedKillerOutlineColor = "çº¢è‰²"
    
    -- æ¸…ç†é«˜äº®å¯¹è±¡
    local function cleanupHighlights()
        for _, highlight in pairs(HighlightSettings.highlights) do
            if highlight and highlight.Parent then
                highlight:Destroy()
            end
        end
        HighlightSettings.highlights = {}
    end
    
    -- æ›´æ–°é«˜äº®æ˜¾ç¤º
    local function updateHighlights()
        local players = game:GetService("Players")
        local localPlayer = players.LocalPlayer

        -- è·å–å¹¸å­˜è€…å’Œæ€æ‰‹æ–‡ä»¶å¤¹
        local survivorsFolder = workspace:FindFirstChild("Players") and workspace.Players:FindFirstChild("Survivors")
        local killersFolder = workspace:FindFirstChild("Players") and workspace.Players:FindFirstChild("Killers")

        -- åªå¤„ç†å¹¸å­˜è€…å’Œæ€æ‰‹
        local function processFolder(folder, isKiller)
            if not folder then return end

            for _, model in ipairs(folder:GetChildren()) do
                if model:IsA("Model") then
                    -- ç¡®å®šé¢œè‰²
                    local fillColor = isKiller and HighlightSettings.KillerColors[HighlightSettings.SelectedKillerColor]
                    or HighlightSettings.SurvivorColors[HighlightSettings.SelectedSurvivorColor]

                    local outlineColor = isKiller and HighlightSettings.KillerOutlineColors[HighlightSettings.SelectedKillerOutlineColor]
                    or HighlightSettings.SurvivorOutlineColors[HighlightSettings.SelectedSurvivorOutlineColor]

                    -- æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦æ˜¾ç¤º
                    if (isKiller and HighlightSettings.ShowKillerHighlights) or
                    (not isKiller and HighlightSettings.ShowSurvivorHighlights) then

                        if not HighlightSettings.highlights[model] then
                            local highlight = Instance.new("Highlight")
                            highlight.Parent = game.CoreGui
                            HighlightSettings.highlights[model] = highlight
                        end

                        local highlight = HighlightSettings.highlights[model]
                        highlight.Adornee = model
                        highlight.FillColor = fillColor
                        highlight.OutlineColor = outlineColor
                        highlight.FillTransparency = HighlightSettings.FillTransparency
                        highlight.OutlineTransparency = HighlightSettings.OutlineTransparency
                    elseif HighlightSettings.highlights[model] then
                        HighlightSettings.highlights[model].Adornee = nil
                    end
                end
            end
        end

        -- å¤„ç†å¹¸å­˜è€…
        processFolder(survivorsFolder, false)

        -- å¤„ç†æ€æ‰‹
        processFolder(killersFolder, true)

        -- æ¸…ç†ä¸å†å­˜åœ¨çš„æ¨¡å‹çš„é«˜äº®
        for model, highlight in pairs(HighlightSettings.highlights) do
            if not model or not model.Parent then
                highlight:Destroy()
                HighlightSettings.highlights[model] = nil
            end
        end
    end
    
    local Toggle13 = Tab5:Toggle({
        Title = "ç»˜åˆ¶æ€»å¼€å…³",
        Desc = "FIN",
        Locked = false,
        Callback = function(enabled)
            if enabled then
                -- åˆå§‹åŒ–è¿æ¥
                if not HighlightSettings.connection then
                    HighlightSettings.connection = game:GetService("RunService").RenderStepped:Connect(updateHighlights)
                end
            else
                -- å…³é—­è¿æ¥
                if HighlightSettings.connection then
                    HighlightSettings.connection:Disconnect()
                    HighlightSettings.connection = nil
                end
                -- æ¸…ç†é«˜äº®å¯¹è±¡
                cleanupHighlights()
            end
        end
    })
    
    local Toggle14 = Tab5:Toggle({
        Title = "ç»˜åˆ¶å¹¸å­˜è€…",
        Desc = "FIN",
        Locked = false,
        Callback = function(enabled)
            HighlightSettings.ShowKillerHighlights = enabled
        end
    })
    
    local Toggle15 = Tab5:Toggle({
        Title = "ç»˜åˆ¶æ€æ‰‹",
        Desc = "FIN",
        Locked = false,
        Callback = function(enabled)
            HighlightSettings.ShowKillerHighlights = enabled
        end
    })
    
    local Toggle16 = Tab5:Toggle({
        Title = "ç»˜åˆ¶å‘ç”µæœº",
        Desc = "æ— æ³•å…³é—­(å°å¿ƒ)",
        Locked = false,
        Callback = function(enabled)
            -- å°† generatorData ç§»åˆ°å›è°ƒå‡½æ•°å†…éƒ¨ï¼Œç¡®ä¿æ¯æ¬¡å¼€å¯éƒ½æ˜¯ç‹¬ç«‹çš„ä½œç”¨åŸŸ
            local generatorData = {}

            if enabled then
                local scanInterval = 0.5
                local lastScanTime = 0

                local distanceSettings = {
                    MinDistance = 5,
                    MaxDistance = 100,
                    MinScale = 0.8,
                    MaxScale = 1.5,
                    MinTextSize = 8,
                    MaxTextSize = 10
                }

                local function updateGeneratorESP(gen, data)
                    if not gen or not gen:FindFirstChild("Main") then return end

                    local character = LocalPlayer.Character
                    local humanoidRootPart = character and character:FindFirstChild("HumanoidRootPart")

                    if gen:FindFirstChild("Progress") then
                        local progress = gen.Progress.Value
                        if progress >= 99 then
                            if data.billboard then data.billboard:Destroy() end
                            if data.distanceBillboard then data.distanceBillboard:Destroy() end
                            if data.highlight then data.highlight:Destroy() end
                            generatorData[gen] = nil
                            return
                        end

                        if data.textLabel then
                            data.textLabel.Text = string.format("ç”µæœºè¿›åº¦: %d%%", progress)
                        end

                        if humanoidRootPart and data.distanceLabel then
                            local distance = (gen.Main.Position - humanoidRootPart.Position).Magnitude
                            data.distanceLabel.Text = string.format("è·ç¦»: %dç±³", math.floor(distance))

                            local distanceRatio = math.clamp(
                                (distance - distanceSettings.MinDistance) /
                                (distanceSettings.MaxDistance - distanceSettings.MinDistance),
                                0, 1
                            )

                            local scale = distanceSettings.MinScale +
                            distanceRatio * (distanceSettings.MaxScale - distanceSettings.MinScale)

                            local textSize = distanceSettings.MinTextSize +
                            distanceRatio * (distanceSettings.MaxTextSize - distanceSettings.MinTextSize)

                            if data.billboard then data.billboard.Size = UDim2.new(4 * scale, 0, 1 * scale, 0) end
                            if data.distanceBillboard then data.distanceBillboard.Size = UDim2.new(4 * scale, 0, 1 * scale, 0) end
                            if data.textLabel then data.textLabel.TextSize = textSize end
                            if data.distanceLabel then data.distanceLabel.TextSize = textSize end

                            local transparency = math.clamp((distance - 50) / 100, 0, 0.4)
                            if data.textLabel then data.textLabel.TextTransparency = transparency end
                            if data.distanceLabel then data.distanceLabel.TextTransparency = transparency end
                            if data.highlight then data.highlight.FillTransparency = 0.85 + (transparency * 0.5) end
                        end
                    end
                end

                local function createGeneratorESP(gen)
                    if not gen or not gen:FindFirstChild("Main") or generatorData[gen] then return end

                    local billboard = Instance.new("BillboardGui")
                    billboard.Name = "GeneratorESP"
                    billboard.Size = UDim2.new(4, 0, 1, 0)
                    billboard.StudsOffset = Vector3.new(0, 2.5, 0)
                    billboard.Adornee = gen.Main
                    billboard.Parent = gen.Main
                    billboard.AlwaysOnTop = true

                    local textLabel = Instance.new("TextLabel")
                    textLabel.Size = UDim2.new(1, 0, 0.5, 0)
                    textLabel.BackgroundTransparency = 1
                    textLabel.TextScaled = false
                    textLabel.Text = "ç”µæœºåŠ è½½ä¸­..."
                    textLabel.TextColor3 = Color3.fromRGB(0, 255, 255)
                    textLabel.Font = Enum.Font.Arcade
                    textLabel.TextStrokeTransparency = 0
                    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                    textLabel.TextSize = 8
                    textLabel.Parent = billboard

                    local distanceBillboard = Instance.new("BillboardGui")
                    distanceBillboard.Name = "GeneratorDistanceESP"
                    distanceBillboard.Size = UDim2.new(4, 0, 1, 0)
                    distanceBillboard.StudsOffset = Vector3.new(0, 3.5, 0)
                    distanceBillboard.Adornee = gen.Main
                    distanceBillboard.Parent = gen.Main
                    distanceBillboard.AlwaysOnTop = true

                    local distanceLabel = Instance.new("TextLabel")
                    distanceLabel.Size = UDim2.new(1, 0, 0.5, 0)
                    distanceLabel.BackgroundTransparency = 1
                    distanceLabel.TextScaled = false
                    distanceLabel.Text = "è®¡ç®—è·ç¦»ä¸­..."
                    distanceLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                    distanceLabel.Font = Enum.Font.Arcade
                    distanceLabel.TextStrokeTransparency = 0
                    distanceLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                    distanceLabel.TextSize = 8
                    distanceLabel.Parent = distanceBillboard

                    local highlight = Instance.new("Highlight")
                    highlight.Name = "GeneratorHighlight"
                    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                    highlight.Enabled = true
                    highlight.OutlineColor = Color3.fromRGB(0, 255, 255)
                    highlight.FillColor = Color3.fromRGB(0, 255, 255)
                    highlight.FillTransparency = 0.9
                    highlight.OutlineTransparency = 0
                    highlight.Parent = gen

                    generatorData[gen] = {
                        billboard = billboard,
                        distanceBillboard = distanceBillboard,
                        textLabel = textLabel,
                        distanceLabel = distanceLabel,
                        highlight = highlight
                    }

                    gen.Destroying:Connect(function()
                        if generatorData[gen] then
                            if generatorData[gen].billboard then generatorData[gen].billboard:Destroy() end
                            if generatorData[gen].distanceBillboard then generatorData[gen].distanceBillboard:Destroy() end
                            if generatorData[gen].highlight then generatorData[gen].highlight:Destroy() end
                            generatorData[gen] = nil
                        end
                    end)
                end

                local function scanGenerators()
                    for _, gen in pairs(workspace:GetDescendants()) do
                        if gen:IsA("Model") and gen:FindFirstChild("Main") and gen.Name == "Generator" then
                            createGeneratorESP(gen)
                        end
                    end
                end

                local mainConnection = workspace.DescendantAdded:Connect(function(v)
                    if v:IsA("Model") and v:FindFirstChild("Main") and v.Name == "Generator" then
                        createGeneratorESP(v)
                    end
                end)

                local heartbeatConnection = RunService.Heartbeat:Connect(function(deltaTime)
                    lastScanTime = lastScanTime + deltaTime
                    if lastScanTime >= scanInterval then
                        lastScanTime = 0
                        scanGenerators()
                    end

                    for gen, data in pairs(generatorData) do
                        if gen and gen.Parent then
                            updateGeneratorESP(gen, data)
                        else
                            if data.billboard then data.billboard:Destroy() end
                            if data.distanceBillboard then data.distanceBillboard:Destroy() end
                            if data.highlight then data.highlight:Destroy() end
                            generatorData[gen] = nil
                        end
                    end
                end)

                -- å­˜å‚¨è¿æ¥ä»¥ä¾¿ä¹‹åæ–­å¼€
                generatorData.connections = {
                    main = mainConnection,
                    heartbeat = heartbeatConnection
                }
            else
                -- å…³é—­åŠŸèƒ½æ—¶çš„æ¸…ç†é€»è¾‘
                if generatorData.connections then
                    for _, connection in pairs(generatorData.connections) do
                        if connection then
                            connection:Disconnect()
                        end
                    end
                end

                for gen, data in pairs(generatorData) do
                    if type(data) == "table" then
                        if data.billboard then data.billboard:Destroy() end
                        if data.distanceBillboard then data.distanceBillboard:Destroy() end
                        if data.highlight then data.highlight:Destroy() end
                    end
                end
            end
        end
    })
    
    local Tab6 = Window:Tab({
        Title = "ç¾åŒ–ä¸åŠ¨ä½œ",
        Icon = "sparkles",
        Locked = false,
    })
    
    -- VIPåŠ¨ä½œé€šç”¨å‡½æ•°
    local function setupVIPAction(state, soundId)
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local humanoid = char:WaitForChild("Humanoid")
        local rootPart = char:WaitForChild("HumanoidRootPart")

        if state then
            -- å­˜å‚¨åŸå§‹å€¼ä»¥ä¾¿æ¢å¤
            local originalJumpPower = humanoid.JumpPower
            local originalPlatformStand = humanoid.PlatformStand

            -- æ¿€æ´»çŠ¶æ€
            humanoid.PlatformStand = true
            humanoid.JumpPower = 0

            local bodyVelocity = Instance.new("BodyVelocity")
            bodyVelocity.MaxForce = Vector3.new(100000, 100000, 100000)
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
            bodyVelocity.Parent = rootPart

            local animation = Instance.new("Animation")
            animation.AnimationId = "rbxassetid://138019937280193"
            local animationTrack = humanoid:LoadAnimation(animation)
            animationTrack:Play()

            local sound = Instance.new("Sound")
            sound.SoundId = soundId
            sound.Parent = rootPart
            sound.Volume = 0.5
            sound.Looped = true
            sound:Play()

            -- æ£€æŸ¥ç‰¹æ•ˆè·¯å¾„æ˜¯å¦å­˜åœ¨
            local replicatedStorage = ReplicatedStorage
            local effect
            if replicatedStorage:FindFirstChild("Assets") then
                local assets = replicatedStorage.Assets
                if assets:FindFirstChild("Emotes") then
                    local emotes = assets.Emotes
                    if emotes:FindFirstChild("HakariDance") then
                        local hakariDance = emotes.HakariDance
                        if hakariDance:FindFirstChild("HakariBeamEffect") then
                            effect = hakariDance.HakariBeamEffect:Clone()
                            effect.Name = "PlayerEmoteVFX"
                            effect.CFrame = rootPart.CFrame * CFrame.new(0, -1, -0.3)

                            -- ç¡®ä¿æœ‰WeldConstraint
                            if effect:FindFirstChildOfClass("WeldConstraint") then
                                effect.WeldConstraint.Part0 = rootPart
                                effect.WeldConstraint.Part1 = effect
                            end

                            effect.Parent = char
                            effect.CanCollide = false
                        end
                    end
                end
            end

            -- å‘é€ç½‘ç»œäº‹ä»¶
            local networkModule = replicatedStorage:FindFirstChild("Modules")
            if networkModule then
                local network = networkModule:FindFirstChild("Network")
                if network then
                    local remoteEvent = network:FindFirstChild("RemoteEvent")
                    if remoteEvent then
                        remoteEvent:FireServer("PlayEmote", "Animations", "HakariDance")
                    end
                end
            end

            -- åŠ¨ç”»åœæ­¢æ—¶çš„å¤„ç†
            animationTrack.Stopped:Connect(function()
                humanoid.PlatformStand = originalPlatformStand
                humanoid.JumpPower = originalJumpPower
                if bodyVelocity and bodyVelocity.Parent then
                    bodyVelocity:Destroy()
                end
                if sound and sound.Parent then
                    sound:Stop()
                    sound:Destroy()
                end
                if effect and effect.Parent then
                    effect:Destroy()
                end
            end)
        else
            -- å…³é—­çŠ¶æ€
            humanoid.PlatformStand = false
            humanoid.JumpPower = 50  -- æ¢å¤é»˜è®¤è·³è·ƒåŠ›

            local bodyVelocity = rootPart:FindFirstChildOfClass("BodyVelocity")
            if bodyVelocity then
                bodyVelocity:Destroy()
            end

            local sound = rootPart:FindFirstChildOfClass("Sound")
            if sound then
                sound:Stop()
                sound:Destroy()
            end

            local effect = char:FindFirstChild("PlayerEmoteVFX")
            if effect then
                effect:Destroy()
            end

            for _, track in ipairs(humanoid:GetPlayingAnimationTracks()) do
                if track.Animation.AnimationId == "rbxassetid://138019937280193" then
                    track:Stop()
                end
            end
        end
    end
    
    local Toggle17 = Tab6:Toggle({
        Title = "VIPåŠ¨ä½œ",
        Desc = "æ–°ç‰ˆ",
        Locked = false,
        Callback = function(state)
            setupVIPAction(state, "rbxassetid://109474987384441")
        end
    })
    
    local Toggle18 = Tab6:Toggle({
        Title = "VIPåŠ¨ä½œ",
        Desc = "æ—§ç‰ˆ",
        Locked = false,
        Callback = function(state)
            setupVIPAction(state, "rbxassetid://87166578676888")
        end
    })
    
    local Button = Tab6:Button({
        Title = "è°¢å¾·ç¾åŒ–",
        Desc = "çº§é«˜",
        Locked = false,
        Callback = function()
            local player = LocalPlayer
            local character = player.Character or player.CharacterAdded:Wait()
            local shirt = character:FindFirstChildOfClass("Shirt") or Instance.new("Shirt", character)
            shirt.ShirtTemplate = "http://www.roblox.com/asset/?id=14248399102"
            local pants = character:FindFirstChildOfClass("Pants") or Instance.new("Pants", character)
            pants.PantsTemplate = "http://www.roblox.com/asset/?id=14248410313"
            local head = character:FindFirstChild("Head")
            if head then
                local face = head:FindFirstChild("face")
                if face then
                    face:Destroy()
                end
            end

            local function addAccessory(name, meshId, textureId, parentPartName, handleSize, position, rotation, customWeldC0, customWeldC1, meshScale, meshOffset)
                local accessory = Instance.new("Accessory")
                accessory.Name = name
                local handle = Instance.new("Part")
                handle.Name = "Handle"
                handle.Size = Vector3.new(unpack(handleSize))
                handle.CanCollide = false
                handle.Anchored = false
                handle.Parent = accessory
                local mesh = Instance.new("SpecialMesh", handle)
                mesh.MeshId = meshId
                if textureId ~= "" then
                    mesh.TextureId = textureId
                end
                if meshScale then
                    mesh.Scale = Vector3.new(unpack(meshScale))
                else
                    mesh.Scale = Vector3.new(0.65, 0.65, 0.65)
                end
                if meshOffset then
                    mesh.Offset = Vector3.new(unpack(meshOffset))
                else
                    mesh.Offset = Vector3.new(0, -0.55, 0)
                end
                local targetPart = character:FindFirstChild(parentPartName)
                if not targetPart then
                    warn("Target part '" .. parentPartName .. "' not found in character!")
                    return
                end
                local weld = Instance.new("Weld")
                weld.Part0 = targetPart
                weld.Part1 = handle
                if customWeldC0 and customWeldC1 then
                    weld.C0 = CFrame.new(unpack(customWeldC0))
                    weld.C1 = CFrame.new(unpack(customWeldC1))
                else
                    weld.C0 = CFrame.new(unpack(position)) * CFrame.Angles(math.rad(rotation[1]), math.rad(rotation[2]), math.rad(rotation[3]))
                end
                weld.Parent = handle
                accessory.Parent = character
            end
            addAccessory("Face", "rbxassetid://110562243236643", "rbxassetid://92220809340639", "Head", {1,1,1}, {0,0.55,0}, {0,180,0}, nil, nil, {1,1,1}, nil)
            addAccessory("Blade", "rbxassetid://18116147526", "rbxassetid://18955600612", "Right Arm", {1, 1, 1}, {-0.5, -1.1, -3.3}, {180, -100, 0}, nil, nil, {1, 1, 1}, nil)
            addAccessory("Helmet", "rbxassetid://13252936277", "rbxassetid://13252949489", "Head", {1, 1, 1}, {0, 0.8, 0}, {0, 0, 0}, nil, nil, {1.1, 1, 1}, nil)
            addAccessory("Scarf", "rbxassetid://7459110498", "rbxassetid://7543326394", "Torso", {1, 1, 1}, {0, 1.4, 0}, {0, 0, 0}, nil, nil, {1, 1, 1}, nil)
            addAccessory("LeftSleeve", "rbxassetid://14886992040", "rbxassetid://14887049482", "Left Arm", {1, 1, 1}, {0, 1.2, 0}, {0, 0, 0}, nil, nil, {0.15, 0.15, 0.15}, nil)
            addAccessory("Hair", "rbxassetid://7666931987", "rbxassetid://7066058408", "Head", {1, 1, 1}, {0, -1.3, 1.3}, {0, 0, 0}, nil, nil, {1, 1, 1}, nil)
            addAccessory("RightSleeve", "rbxassetid://7265541707", "rbxassetid://7265983163", "Right Arm", {1, 1, 1}, {0.25, 1.5, 0}, {0, 0, 0}, nil, nil, {1, 1, 1}, nil)
            local shedletsky = workspace.Players.Survivors:FindFirstChild("Shedletsky")
            if shedletsky then
                local expressionHolder = shedletsky:FindFirstChild("ExpressionHolder")
                if expressionHolder then
                    expressionHolder:Destroy()
                end
                local shedHair = shedletsky:FindFirstChild("ShedHair")
                if shedHair then
                    shedHair:Destroy()
                end
                local sword = shedletsky:FindFirstChild("Sword")
                if sword then
                    sword:Destroy()
                end
            end
        end
    })
    
    local Button2 = Tab6:Button({
        Title = "å°å­©ç¾åŒ–",
        Desc = "é«˜çº§",
        Locked = false,
        Callback = function()
            warn("")
        end
    })
    
    local Tab7 = Window:Tab({
        Title = "è®¿å®¢è‡ªåŠ¨æ ¼æŒ¡",
        Icon = "shield",
        Locked = false,
    })

    -- è‡ªåŠ¨æ ¼æŒ¡åŠŸèƒ½
    local function InitAutoBlock(Tab7)
        local Players = game:GetService("Players")
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local RunService = game:GetService("RunService")

        local config = {
            Enabled = false,
            BaseDistance = 15,
            BlockCooldown = 0.35,
            SpeedThreshold = 8
        }

        local AnimationIDs = {
            ["126830014841198"] = true,
            ["126355327951215"] = true,
            ["121086746534252"] = true,
            ["18885909645"] = true,
            ["98456918873918"] = true,
            ["105458270463374"] = true,
            ["83829782357897"] = true,
            ["125403313786645"] = true,
            ["118298475669935"] = true,
            ["82113744478546"] = true,
            ["70371667919898"] = true,
            ["99135633258223"] = true,
            ["97167027849946"] = true,
            ["109230267448394"] = true,
            ["139835501033932"] = true,
            ["126896426760253"] = true,
        }

        local LocalPlayer = Players.LocalPlayer
        local RemoteEvent
        local lastBlockTime = 0
        local combatConnection

        pcall(function()
            RemoteEvent = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Network"):WaitForChild("RemoteEvent")
        end)

        local function HasTargetAnimation(character)
            if not character then return false end
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if not humanoid then return false end
            local animator = humanoid:FindFirstChildOfClass("Animator")
            if not animator then return false end
            for _, track in pairs(animator:GetPlayingAnimationTracks()) do
                if track.Animation then
                    local animId = tostring(track.Animation.AnimationId:match("%d+"))
                    if AnimationIDs[animId] then
                        return true
                    end
                end
            end
            return false
        end

        local function GetThreateningKillers()
            local killers = {}
            local killersFolder
            pcall(function()
                killersFolder = workspace:FindFirstChild("Killers") 
                if not killersFolder and workspace:FindFirstChild("Players") then
                    killersFolder = workspace.Players:FindFirstChild("Killers")
                end
            end)
            if not killersFolder then return killers end
            local myCharacter = LocalPlayer.Character
            if not myCharacter then return killers end
            local myRoot = myCharacter:FindFirstChild("HumanoidRootPart")
            if not myRoot then return killers end
            for _, killer in ipairs(killersFolder:GetChildren()) do
                if killer:FindFirstChild("HumanoidRootPart") then
                    local killerRoot = killer.HumanoidRootPart
                    local distance = (killerRoot.Position - myRoot.Position).Magnitude
                    if distance <= config.BaseDistance and HasTargetAnimation(killer) then
                        table.insert(killers, killer)
                    end
                end
            end
            return killers
        end

        local function PerformBlock()
            local now = tick()
            if now - lastBlockTime >= config.BlockCooldown then
                if RemoteEvent then
                    pcall(function()
                        RemoteEvent:FireServer("UseActorAbility", "Block")
                    end)
                end
                lastBlockTime = now
            end
        end

        local function CombatLoop()
            if not config.Enabled then return end
            pcall(function()
                local killers = GetThreateningKillers()
                if #killers > 0 then
                    PerformBlock()
                end
            end)
        end

        local Toggle19 = Tab7:Toggle({
            Title = "è‡ªåŠ¨æ ¼æŒ¡å¼€å…³",
            Desc = "åŠ¨ç”»",
            Locked = false,
            Callback = function(enabled)
                config.Enabled = enabled
                if enabled then
                    if combatConnection then
                        combatConnection:Disconnect()
                    end
                    combatConnection = RunService.Stepped:Connect(CombatLoop)
                elseif combatConnection then
                    combatConnection:Disconnect()
                    combatConnection = nil
                end
            end
        })

        local Slider3 = Tab7:Slider({
            Title = "æ ¼æŒ¡è·ç¦»è°ƒèŠ‚",
            Value = {
                Min = 5,
                Max = 35,
                Default = 15,
            },
            Increment = 1,
            Callback = function(value)
                config.BaseDistance = value
            end
        })

        LocalPlayer.CharacterAdded:Connect(function()
            if config.Enabled and combatConnection then
                combatConnection:Disconnect()
                combatConnection = RunService.Stepped:Connect(CombatLoop)
            end
        end)

        return {
            Toggle = Toggle19,
            Slider = Slider3,
            Config = config
        }
    end

    -- åˆå§‹åŒ–è‡ªåŠ¨æ ¼æŒ¡
    local AutoBlock = InitAutoBlock(Tab7)

    local Button = Tab7:Button({
        Title = "è®¿å®¢å‡æ ¼æŒ¡",
        Desc = "éª—æ€æ‰‹",
        Locked = false,
        Callback = function()
            local Players = game:GetService("Players")
            local localPlayer = Players.LocalPlayer

            if game.CoreGui:FindFirstChild("FakeBlockGui") then
                game.CoreGui:FindFirstChild("FakeBlockGui"):Destroy()
            end

            local gui = Instance.new("ScreenGui")
            gui.Name = "FakeBlockGui"
            gui.ResetOnSpawn = false
            gui.Parent = game.CoreGui

            local frame = Instance.new("Frame")
            frame.Position = UDim2.new(0, 10, 0, 10)
            frame.Size = UDim2.new(0, 170, 0, 140)
            frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            frame.Active = true
            frame.Draggable = true
            frame.Parent = gui

            local showToggle = Instance.new("TextButton")
            showToggle.Position = UDim2.new(0, 5, 0, 115)
            showToggle.Size = UDim2.new(0, 160, 0, 20)
            showToggle.Text = "å…³é—­é¡µé¢"
            showToggle.Parent = frame

            local normalToggle = Instance.new("TextButton")
            normalToggle.Position = UDim2.new(0, 5, 0, 5)
            normalToggle.Size = UDim2.new(0, 160, 0, 30)
            normalToggle.Text = "è®¿å®¢çš®è‚¤å‡é˜²"
            normalToggle.Parent = frame

            local m3toggle = Instance.new("TextButton")
            m3toggle.Position = UDim2.new(0, 5, 0, 40)
            m3toggle.Size = UDim2.new(0, 160, 0, 30)
            m3toggle.Text = "é‡Œç¨‹ç¢‘3å’Œ4å‡é˜²"
            m3toggle.Parent = frame

            local fakeBlockBtn = Instance.new("TextButton")
            fakeBlockBtn.Position = UDim2.new(0, 5, 0, 75)
            fakeBlockBtn.Size = UDim2.new(0, 160, 0, 30)
            fakeBlockBtn.Text = "å¯åŠ¨"
            fakeBlockBtn.Parent = frame

            local mode = "Normal"
            normalToggle.MouseButton1Click:Connect(function()
                mode = "Normal"
                normalToggle.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
                m3toggle.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            end)

            m3toggle.MouseButton1Click:Connect(function()
                mode = "M3&4"
                m3toggle.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
                normalToggle.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            end)

            showToggle.MouseButton1Click:Connect(function()
                frame.Visible = not frame.Visible
            end)

            local function playFakeBlockAnimation(animId)
                local char = localPlayer.Character
                if char then
                    local humanoid = char:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        local anim = Instance.new("Animation")
                        anim.AnimationId = "rbxassetid://" .. animId
                        local track = humanoid:LoadAnimation(anim)
                        track:Play()
                    end
                end
            end

            fakeBlockBtn.MouseButton1Click:Connect(function()
                if mode == "Normal" then
                    playFakeBlockAnimation("72722244508749")
                elseif mode == "M3&4" then
                    playFakeBlockAnimation("96959123077498")
                end
            end)
        end
    })
end
